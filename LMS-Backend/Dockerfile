# syntax=docker/dockerfile:1

###############################################################################
#  Base image
###############################################################################
FROM python:3.12-slim

###############################################################################
#  Environment
###############################################################################
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    DJANGO_SETTINGS_MODULE=LMSBackend.settings

WORKDIR /app

###############################################################################
#  OS-level build tools (needed for some Python wheels)
###############################################################################
RUN --mount=type=cache,target=/var/cache/apt  \
    apt-get update && \
    apt-get install -y --no-install-recommends build-essential && \
    rm -rf /var/lib/apt/lists/*

###############################################################################
#  Python deps
###############################################################################
COPY requirements.txt .
RUN pip install --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

###############################################################################
#  Project files
###############################################################################
COPY . .

###############################################################################
#  Network & startup
###############################################################################
EXPOSE 8000
CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]
